# 안드로이드

## 개발준비

개발자 옵션 활성화 - 빌드번호 계속 터치

OEM 잠금 해제

USB 디버깅 활성화

창 애니메이션 배율을 x0.5로 낮추면 빨라진다



- JDK 설치 되어있어야 한다

- 삼성 usb 드라이버 설치

- 프로그램 및 기능 - Windows 기능 - Hyper-V 체크

  ![image-20201012105424553](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012105424553.png)

- 안드로이드 스튜디오 설치

  - Configure - SDK Manager - System Settings - Android SDK - SDK Platforms ( Android 9.0 (사용할 버전) - Show Package Detailes 체크 - 아래 내용 설치 ) (Google x86.. 안깔리면 안깔아도 됨)

    ![image-20201012102525296](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012102525296.png)

  - SDK Tools (intel 86.. 안깔리면 안깔아도 됨)

    ![image-20201012104119489](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012104119489.png)

  - Configure - AVD manager - Pixel 2 - Pie (적용하고 싶은 안드로이드 버전) 

  - Configure - Settings - Editor - Font

---

##  안드로이드의 특징

- 오픈 소스이다
- 리눅스 기반이다
- 자바 기반이다
- ART라는 런타임이 탑재



activity_main.xml

- 화면을 만든다

MainActivity.java

- 이벤트 처리

R.java

- 변수 처리

property 파일

- 버전 관리



---

Start a new Android Studio project

- Empty Activity

  ![image-20201012112440153](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012112440153.png)



## 프로그램 구조

1. build.gradle (JAVA SPRING의 MAVEN 같은 파일)

   ![image-20201012113159968](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012113159968.png)

2. **AndroidManifest.xml (전역 환경설정 파일)**

3. **MainActivity.java (실행코드가 들어가는 파일)**

   ![image-20201012113712416](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012113712416.png)

4. **activity_main.xml (화면을 담당)**

   ![image-20201012113833685](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012113833685.png)

5. R.java (자동으로 자원을 관리)



---

## 안드로이드 스튜디오 살펴보기

- 앱 이름 및 아이콘 설정

![image-20201012131450751](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012131450751.png)

( res/values/strings은 문자열을 가져오거나 다국어 설정을 할 때 사용한다 )



![image-20201012134741954](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012134741954.png)

(AndroidManifest.xml)



![image-20201012132244701](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012132244701.png)

(사용할 이미지는 res/drawable에 아이콘은 res/mipmap에 넣는다)



![image-20201012135446954](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012135446954.png)

(하단 Logcat에 로그가 찍힌다)(Logcat 우측에 Show only...를 클릭해 필터로 보고 싶은 로그만 설정할 수 있다)



![image-20201012134341403](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201012134341403.png)

(onCreate 앱이 실행될 때 작동한다)



```java
package com.example.myapplication;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.ImageView;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    ImageView himg;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        himg = findViewById(R.id.himg);
    }

    public void clickBt(View view){
        himg.setVisibility(View.INVISIBLE);
        Log.d("[TEST]", "-----------");
        Toast.makeText(this, "Hello", Toast.LENGTH_SHORT).show();
    }

}
```



## 뷰

### 레이아웃

#### 		ConstraintLayout

#### 		LinearLayout

#### 		FrameLayout

#### 		TableLayout



- layout_width
- layout_height
- layout_weight : 비율로 설정
- layout_span



- text
- hint



- gravity : 내가 가지고 있는 것들에 대한 위치
- layout_gravity : 내 자신의 대한 위치



- dp : 160dpi 화면을 기준으로 한 픽셀 - 뷰에서 사용
- sp : 텍스트 크기를 지정할 때 사용하는 단위 - 글자 크기에 사용



- layout_margin
- padding



- imageView.setImageResource(R.drawable.~);



## 위젯과 이벤트

### 터치 및 드래그 시 이벤트 처리

<img src="md-images/image-20201013174146792.png" alt="image-20201013174146792" style="zoom: 50%;" />

```java
package com.example.p200;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.KeyEvent;
import android.view.MotionEvent;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    TextView textView;
    LinearLayout view;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        textView = findViewById(R.id.textView);
        view = findViewById(R.id.view);
        // 리스너로 이벤트 처리
        view.setOnTouchListener(new View.OnTouchListener() {
            @Override
            public boolean onTouch(View v, MotionEvent event) {
                //이벤트에 대한 정보를 받아온다
                int action = event.getAction();
                float x = event.getX();
                float y = event.getY();
                //터치
                if(action == MotionEvent.ACTION_DOWN){
                    print("DOWN:"+x+","+y);
                //드래그
                }else if(action == MotionEvent.ACTION_MOVE){
                    print("MOVE:"+x+","+y);
                //터치 뗌
                }else if(action == MotionEvent.ACTION_UP){
                    print("UP:"+x+","+y);
                }

                return true;
            }
        });
    } // onCreate end


    public void print(String str){
        textView.setText(str);
    }

//    //키가 눌렸을 때 실행하는 함수
//    @Override
//    public boolean onKeyDown(int keyCode, KeyEvent event) {
//        if(keyCode == KeyEvent.KEYCODE_BACK){
//            Toast.makeText(this, ""+"BACK KEY PRESSED", Toast.LENGTH_SHORT).show();
//        }
//
//        return true;
//    }

	//취소 키가 눌렸을 때
    @Override
    public void onBackPressed() {
       // super.onBackPressed();
        Toast.makeText(this, ""+"BACK KEY PRESSED", Toast.LENGTH_SHORT).show();
        finish();
    }
}
```



### 화면 전환과 앱 상태에 따른 처리

```java
package com.example.p207;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.content.res.Configuration;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    Button button;
    EditText et;
    TextView textView;

    String str;

    //앱이 처음 실행될 때
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        show("onCreate");
        Log.d("[TEST]", "onCreate");

        button = findViewById(R.id.button);
        et = findViewById(R.id.et);
        textView = findViewById(R.id.textView2);

        //버튼 클릭 시 텍스트에디터의 텍스트를 가져온다
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                str = et.getText().toString();  //.getText()는 Editable자료형이라 형변환을 해주어야한다
                Toast.makeText(MainActivity.this, str, Toast.LENGTH_SHORT).show();
            }
        });

    }

    //화면 방향 변환 시 이벤트 처리 (AndroidManifest.xml을 수정해야한다)
    @Override
    public void onConfigurationChanged(@NonNull Configuration newConfig) {
        super.onConfigurationChanged(newConfig);

        if(newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE){
            setContentView(R.layout.activity_main);
            Toast.makeText(this, "LANDSCAPE", Toast.LENGTH_SHORT).show();
        }else if(newConfig.orientation == Configuration.ORIENTATION_PORTRAIT){
            setContentView(R.layout.activity_main);
            Toast.makeText(this, "PORTRAIT", Toast.LENGTH_SHORT).show();
        }
    }

    //앱이 보여질 때
    @Override
    protected void onStart() {
        super.onStart();
        show("onStart");
        Log.d("[TEST]", "onStart");
    }

    //홈버튼 눌렀을 때 or 화면에서 사라질 때 스탑된다
    @Override
    protected void onStop() {
        super.onStop();
        show("onStop");
        Log.d("[TEST]", "onStop");
    }

    //앱이 꺼질 때 실행 된다
    @Override
    protected void onDestroy() {
        super.onDestroy();
        show("onDestroy");
        Log.d("[TEST]", "onDestroy");
    }

    public void show(String str){
        Toast.makeText(this, str, Toast.LENGTH_SHORT).show();
    }
}
```



### 토스트, 스낵바,프로그래스바,대화상자 사용하기

```java
package com.example.p217;

import androidx.appcompat.app.AppCompatActivity;

import android.app.AlertDialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.os.Bundle;
import android.view.Gravity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ProgressBar;
import android.widget.TextView;
import android.widget.Toast;

import com.google.android.material.snackbar.Snackbar;

public class MainActivity extends AppCompatActivity {

    ProgressBar progressBar;  // 프로그레스바 만들기

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        progressBar = findViewById(R.id.progressBar); // 프로그레스바 가져오기
    }

    //안드로이드에서 제공하는 기본 토스트의 위치변경
    public void clickb1(View v){
        Toast t = Toast.makeText(this,"Toast1...",Toast.LENGTH_SHORT);
        t.setGravity(Gravity.CENTER,0,0);
        t.show();
    }

    // 내가 토스트를 만들어서 사용한다
    public void clickb2(View v){

        LayoutInflater inflater = getLayoutInflater();
        View view = inflater.inflate(R.layout.toast,
                (ViewGroup) findViewById(R.id.toast_layout));
        TextView tv = view.findViewById(R.id.textView);
        tv.setText("INPUT TEXT");


        Toast t = new Toast(this);
        t.setGravity(Gravity.CENTER,0,0);
        t.setDuration(Toast.LENGTH_LONG);
        t.setView(view);
        t.show();
    }

    //스낵바 사용
    public void clickb3(View v){
        Snackbar.make(v, "Snack Bar", Snackbar.LENGTH_LONG).show();
    }

    // 다이얼로그 사용
    public void clickb4(View v){
        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setTitle("My Dialog");
        builder.setMessage("Are You Exit Now");
        builder.setIcon(R.drawable.b1);

        //OK을 누르면 종료
        builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                finish();
            }
        });
        //NO를 누르면 그대로
        builder.setNegativeButton("NO", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

            }
        });

        AlertDialog dialog = builder.create();
        dialog.show();
    }

    //프로그래스 바, 스피닝 프로그래스
    public void btprogress(View v){
        ProgressDialog progressDialog = null;
        
        if(v.getId() == R.id.button5){
            int pdata = progressBar.getProgress();
            progressBar.setProgress(pdata + 1);
        }else if(v.getId() == R.id.button6){
            int pdata = progressBar.getProgress();
            progressBar.setProgress(pdata - 1);
        }else if(v.getId() == R.id.button7){
            
            progressDialog = new ProgressDialog(this);            progressDialog.setProgressStyle(ProgressDialog.STYLE_SPINNER);
            progressDialog.setTitle("Downloading ...");
            progressDialog.setCancelable(false);
            progressDialog.show();
        }else if(v.getId() == R.id.button8){
            progressDialog.dismiss();
        }
    }


    //뒤로가기를 눌렀을 때 내가 만든 레이아웃을 setview 해서 dialog를 만든다
    @Override
    public void onBackPressed() {
        //super.onBackPressed();  여기가 없어야 동작한다!

        LayoutInflater inflater = getLayoutInflater();
        View view = inflater.inflate(R.layout.dialog,
                (ViewGroup) findViewById(R.id.dialog_layout));


        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setTitle("My Dialog");
        builder.setMessage("Are You Exit Now");
        builder.setView(view);
        builder.setIcon(R.drawable.b1);

        //OK을 누르면 종료
        builder.setNegativeButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                finish();
            }
        });
        //NO를 누르면 그대로
        builder.setPositiveButton("NO", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {

            }
        });

        AlertDialog dialog = builder.create();
        dialog.show();

    }


} // end class
```



## 화면 전환

- 버튼을 눌러 아래 화면을 바꾸게 한다

![image-20201013160106772](md-images/image-20201013160106772.png)

```java
package com.example.p244;

import androidx.appcompat.app.AppCompatActivity;

import android.content.Context;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity {
	//전환시킬 화면을 container로 한다
    LinearLayout container;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        container = findViewById(R.id.container);
    }

    public void bt(View v){
        if(v.getId() == R.id.button){
            container.removeAllViews();
            LayoutInflater inflater =
                    (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);
            inflater.inflate(R.layout.sub1, container, true);
            TextView tv = container.findViewById(R.id.textView);
            tv.setText("Sub1 Page");
        }else if(v.getId() == R.id.button2){
            container.removeAllViews();
            LayoutInflater inflater =
                    (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);
            inflater.inflate(R.layout.sub2, container, true);
            TextView tv = container.findViewById(R.id.textView2);
            tv.setText("Sub2 Page");
        }
    }
}
```



- Activity 간 전환과 Intent의 ACTION 사용

  - MainActivity.java

  ```java
  package com.example.p251;
  
  import androidx.appcompat.app.AppCompatActivity;
  
  import android.content.Intent;
  import android.os.Bundle;
  import android.view.View;
  
  //Activity간 전환하기
  public class MainActivity extends AppCompatActivity {
  
      @Override
      protected void onCreate(Bundle savedInstanceState) {
          super.onCreate(savedInstanceState);
          setContentView(R.layout.activity_main);
      }
  
      //화면 SecondActivity을 띄운다
      public void ckbt(View v){
          Intent intent = new Intent(getApplicationContext(),SecondActivity.class);
          intent.putExtra("data", 100); //데이터를 담아서 다음 액티비티로 전달
          intent.putExtra("str", "String Data");
  
          startActivity(intent);
      }
  
  }
  ```

  - SecondActivity.java

  ```JAVA
  package com.example.p251;
  
  import androidx.appcompat.app.AppCompatActivity;
  
  import android.content.Intent;
  import android.os.Bundle;
  import android.view.View;
  import android.widget.Toast;
  
  public class SecondActivity extends AppCompatActivity {
  
      @Override
      protected void onCreate(Bundle savedInstanceState) {
          super.onCreate(savedInstanceState);
          setContentView(R.layout.activity_second);
  
          Intent intent = getIntent();
          //int result = intent.getIntExtra("data",0); //데이터를 받는다 default는 0으로 설정
          Bundle bundle = intent.getExtras(); //여러개 받을 때 번들사용
          int result = bundle.getInt("data",0);
          String str_result = bundle.getString("str","");
          Toast.makeText(this, ""+str_result, Toast.LENGTH_SHORT).show();
  
      }
  
      public void ckbt2(View v){
          Intent intent = new Intent(getApplicationContext(),ThirdActivity.class);
          startActivity(intent);
      }
  
  }
  ```

  - ThirdActivity.java

  ```java
  package com.example.p251;
  
  import androidx.appcompat.app.AppCompatActivity;
  import androidx.core.content.PermissionChecker;
  
  
  import android.Manifest;
  import android.content.Intent;
  import android.content.pm.PackageManager;
  import android.net.Uri;
  import android.os.Bundle;
  import android.view.View;
  import android.widget.Toast;
  
  public class ThirdActivity extends AppCompatActivity {
  
      @Override
      protected void onCreate(Bundle savedInstanceState) {
          super.onCreate(savedInstanceState);
          setContentView(R.layout.activity_third);
      }
      public void ckbt3(View v){
          Intent intent = null;
          //전화 거는 화면으로 이동
          if(v.getId() == R.id.button3){
              intent = new Intent(Intent.ACTION_VIEW, Uri.parse("tel:010-9879-2039"));
              startActivity(intent);
           //전화번호부 화면으로 이동
          }else if(v.getId() == R.id.button4){
              intent = new Intent(Intent.ACTION_VIEW, Uri.parse("content://contacts/people"));
              startActivity(intent);
           //전화 걸기
          }else if(v.getId() == R.id.button5){
              //전화 걸때는 CALL_PHONE을 허용해야 함!
              //AndroidManifest.xml에 추가해야 함!
              int check = PermissionChecker.checkSelfPermission(
                      this, Manifest.permission.CALL_PHONE
              );
  
              if(check == PackageManager.PERMISSION_GRANTED){
                  intent = new Intent(Intent.ACTION_CALL, Uri.parse("tel:010-9878-8989"));
                  startActivity(intent);
              }else{
                  Toast.makeText(this, "Not Allowed", Toast.LENGTH_SHORT).show();
              }
          }
      }
  }
  ```

  

## Android 4 Component

- Activity : Base, UI
- Service : Background Process
- Broadcast Receiver : (OS정보와 같은) Broadcast 내용을 받는다
- Content Provider :  App Data 공유 (ex. 갤러리의 사진, 주소록의 전화번호를 가져온다)



## 액티비티의 수명주기와 SharedPreference

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014145926389.png" alt="image-20201014145926389" style="zoom:80%;" />

```java
package com.example.p275;

import androidx.appcompat.app.AppCompatActivity;

import android.app.Activity;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.util.Log;
import android.widget.Toast;

import java.util.Date;

public class MainActivity extends AppCompatActivity {

    SharedPreferences sp;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Log.d("[TEST]", "onCreate");
    }
    @Override
    protected void onStart() {
        super.onStart();
        Log.d("[TEST]", "onStart");
    }

    //onResume()가 되면 불러온다
    @Override
    protected void onResume() {
        super.onResume();
        restoreState();
        Log.d("[TEST]", "onResume");
    }

    @Override
    protected void onRestart() {
        super.onRestart();
        Log.d("[TEST]", "onRestart");
    }

    //onPause()가 되면 저장한다
    @Override
    protected void onPause() {
        super.onPause();
        saveState();
        Log.d("[TEST]", "onPause");
    }

    @Override
    protected void onStop() {
        super.onStop();
        Log.d("[TEST]", "onStop");
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        Log.d("[TEST]", "onDestroy");
    }


    //토스트로 저장 된 날자를 불러온다
    public void restoreState(){
        sp = getSharedPreferences("st", Activity.MODE_PRIVATE);
        if(sp != null && sp.contains("date")){
            String result = sp.getString("date","");
            Toast.makeText(this, result, Toast.LENGTH_SHORT).show();
        }
    }

    //날자를 저장한다
    public void saveState(){
        sp = getSharedPreferences("st", Activity.MODE_PRIVATE); // Activity.MODE_PRIVATE는 이 앱만 볼 수 있다
        SharedPreferences.Editor editor = sp.edit();
        Date d = new Date();
        editor.putString("date", d.toString());
        editor.commit();
    }

}
```





## 프래그먼트

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014144953870.png" alt="image-20201014144953870" style="zoom: 50%;" />

- 프래그먼트 화면전환과 액션바의 메뉴(...) 만들기

  - MainActivity.java

  ```java
  package com.example.p287;
  
  import androidx.annotation.NonNull;
  import androidx.appcompat.app.ActionBar;
  import androidx.appcompat.app.AppCompatActivity;
  
  import android.os.Bundle;
  import android.view.Menu;
  import android.view.MenuItem;
  import android.view.View;
  
  public class MainActivity extends AppCompatActivity {
  
      Fragment1 fragment1;
      Fragment2 fragment2;
      Fragment3 fragment3;
  
      ActionBar actionBar; // 메뉴 만들기 (androidx를 가져와야 한다)
  
      @Override
      protected void onCreate(Bundle savedInstanceState) {
          super.onCreate(savedInstanceState);
          setContentView(R.layout.activity_main);
  
          fragment1 = new Fragment1();
  //        fragment1 = (Fragment1)getSupportFragmentManager().findFragmentById(
  //                        R.id.fragment
  //                    );
          fragment2 = new Fragment2();
          fragment3 = new Fragment3();
  
          actionBar = getSupportActionBar();
          actionBar.setTitle("Fragment");
          actionBar.setLogo(R.drawable.icon);
          actionBar.setDisplayOptions(ActionBar.DISPLAY_SHOW_HOME |
                  ActionBar.DISPLAY_SHOW_TITLE | ActionBar.DISPLAY_USE_LOGO);
          //actionBar.hide(); // 액션바 숨기기
  
      }
  
      //메뉴(...)를 붙임
      @Override
      public boolean onCreateOptionsMenu(Menu menu) {
          getMenuInflater().inflate(R.menu.mymenu,menu);
          return true;
      }
  
      //메뉴(...)에 이벤트를 생성
      @Override
      public boolean onOptionsItemSelected(@NonNull MenuItem item) {
          if(item.getItemId() == R.id.m1){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment1
              ).commit();
          }else if (item.getItemId() == R.id.m2){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment2
              ).commit();
          }else if (item.getItemId() == R.id.m3){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment3
              ).commit();
          }
          return super.onOptionsItemSelected(item);
      }
  
      public void ckbt(View v){
          if(v.getId() == R.id.button){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment1
              ).commit();
          }else if(v.getId() == R.id.button2){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment2
              ).commit();
          }else if(v.getId() == R.id.button3){
              getSupportFragmentManager().beginTransaction().replace(
                      R.id.fragment, fragment3
              ).commit();
          }
      }
  }
  ```

  

  - Fragment1.java

    ```java
    package com.example.p287;
    
    import android.os.Bundle;
    import android.view.LayoutInflater;
    import android.view.View;
    import android.view.ViewGroup;
    import android.widget.Button;
    import android.widget.EditText;
    import android.widget.ImageView;
    import android.widget.TextView;
    
    import androidx.annotation.NonNull;
    import androidx.annotation.Nullable;
    import androidx.fragment.app.Fragment;
    
    public class Fragment1 extends Fragment {
    
        TextView textView;
        EditText editText;
        Button button5;
        ImageView imageView;
    
        public Fragment1(){}
    
        @Nullable
        @Override
        public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
            ViewGroup viewGroup = null;
            viewGroup = (ViewGroup) inflater.inflate(R.layout.fragment_1,container,false);
            textView = viewGroup.findViewById(R.id.textView);
            editText = viewGroup.findViewById(R.id.editText);
            button5 = viewGroup.findViewById(R.id.button5);
            imageView = viewGroup.findViewById(R.id.imageView);
    
            imageView.setOnClickListener(new View.OnClickListener(){
                @Override
                public void onClick(View v) {
                    String str = editText.getText().toString();
                    textView.setText(str);
                }
            }) ;
    
            return viewGroup;
        }
    
    }
    ```

    

  - Fragment2.java

    ```java
    package com.example.p287;
    
    import android.os.Bundle;
    import android.view.LayoutInflater;
    import android.view.View;
    import android.view.ViewGroup;
    
    import androidx.annotation.NonNull;
    import androidx.annotation.Nullable;
    import androidx.fragment.app.Fragment;
    
    public class Fragment2 extends Fragment {
        public Fragment2(){}
    
        @Nullable
        @Override
        public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
            return inflater.inflate(R.layout.fragment_2, container, false);
        }
    }
    ```

    

## 상단탭과 하단탭

하단탭 예제

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014155906839.png" alt="image-20201014155906839" style="zoom:50%;" />



- bottom_menu.xml

![image-20201014154948129](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014154948129.png)



- activity_main.xml

![image-20201014155104613](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014155104613.png)

- MainActivity.java

```JAVA
package com.example.p331;

import androidx.annotation.NonNull;
import androidx.appcompat.app.ActionBar;
import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.FragmentManager;

import android.os.Bundle;
import android.view.MenuItem;
import android.widget.Toast;

import com.google.android.material.bottomnavigation.BottomNavigationView;

public class MainActivity extends AppCompatActivity {

    BottomNavigationView bottomNavigationView;
    ActionBar actionBar;

    Fragment1 fragment1;
    Fragment2 fragment2;
    Fragment3 fragment3;

    FragmentManager fragmentManager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        fragment1 = new Fragment1();
        fragment2 = new Fragment2();
        fragment3 = new Fragment3();

        //처음 화면을 fragment1로 설정한다
        fragmentManager = getSupportFragmentManager();
        fragmentManager.beginTransaction().replace(
                R.id.framelayout, fragment1).commit();
		
        //액션바 삭제
        actionBar = getSupportActionBar();
        actionBar.hide();

        //하단탭 설정
        bottomNavigationView = findViewById(R.id.bottom_nav);
        bottomNavigationView.setOnNavigationItemSelectedListener(new BottomNavigationView.OnNavigationItemSelectedListener() {
            @Override
            public boolean onNavigationItemSelected(@NonNull MenuItem menuItem) {
                if(menuItem.getItemId() == R.id.tab1){
                    fragmentManager.beginTransaction().replace(
                            R.id.framelayout, fragment1).commit();
                    Toast.makeText(MainActivity.this, "tab1", Toast.LENGTH_SHORT).show();
                }else if(menuItem.getItemId() == R.id.tab2){
                    fragmentManager.beginTransaction().replace(
                            R.id.framelayout, fragment2).commit();
                    Toast.makeText(MainActivity.this, "tab2", Toast.LENGTH_SHORT).show();
                }else if(menuItem.getItemId() == R.id.tab3){
                    fragmentManager.beginTransaction().replace(
                            R.id.framelayout, fragment3).commit();
                    Toast.makeText(MainActivity.this, "tab3", Toast.LENGTH_SHORT).show();
                }
                return false;
            }
        });  // end function
    }
}
```



- fragment_1.xml

![image-20201014155141504](%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201014155141504.png)

- Fragment1.java

```java
package com.example.p331;

import android.os.Bundle;

import androidx.fragment.app.Fragment;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.Toast;

public class Fragment1 extends Fragment {

    Button button;
    
    public Fragment1() {
        // Required empty public constructor
    }
    
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        ViewGroup viewGroup = null;
        viewGroup = (ViewGroup) inflater.inflate(R.layout.fragment_1,container,false);
        button = viewGroup.findViewById(R.id.button);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Toast.makeText(getActivity(), "tab11", Toast.LENGTH_SHORT).show();
            }            // Fragment에서 Toast를 사용하려면 getActivity()를 넣어준다!!!!
        });

        return viewGroup;
    }
    
}
```

## 브로드캐스트 수신자 사용하기

<img src="md-images/image-20201015125530741.png" alt="image-20201015125530741" style="zoom:50%;" />

```java
package com.example.p362;

import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.content.PermissionChecker;

import android.Manifest;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.pm.PackageManager;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.net.Uri;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.telephony.SmsMessage;
import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;

import java.util.Date;

public class MainActivity extends AppCompatActivity {
    ImageView imageView;
    TextView textView;

    BroadcastReceiver broadcastReceiver;

    //어떤 브로드캐스트를 받을지 등록한다
    IntentFilter intentFilter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        imageView = findViewById(R.id.imageView);
        textView = findViewById(R.id.textView);

        //어떤 퍼미션을 등록할건지 (AndroidManifest.xml에 기입되어야 함)
        String permissions [] = {
                Manifest.permission.CALL_PHONE,
                Manifest.permission.SEND_SMS,
                Manifest.permission.RECEIVE_SMS
        };
        ActivityCompat.requestPermissions(this,permissions,101);

        //브로드캐스트의 사용
        intentFilter = new IntentFilter();
        intentFilter.addAction("android.net.conn.CONNECTIVITY_CHANGE");
        intentFilter.addAction("android.provider.Telephony.SMS_RECEIVED");

        broadcastReceiver = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                String cmd = intent.getAction();
                ConnectivityManager cm = null;
                NetworkInfo mobile = null;
                NetworkInfo wifi = null;

                //네트워크의 변경 상태에 따라 이미지뷰를 바꾼다
                //브로드캐스트를 까보니..네트워크가 변경 되었다면
                if(cmd.equals("android.net.conn.CONNECTIVITY_CHANGE")){
                    //현재 네트워크 상태를 받아온다
                    cm = (ConnectivityManager) context.getSystemService(
                            Context.CONNECTIVITY_SERVICE
                    );
                    mobile = cm.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
                    wifi = cm.getNetworkInfo(ConnectivityManager.TYPE_WIFI);

                    //네트워크가 연결 되었다면
                    if(mobile != null && mobile.isConnected()){

                    }
                    //와이파이가 연결 되었다면
                    else if(wifi != null && wifi.isConnected()){
                        imageView.setImageResource(R.drawable.wifi);
                    }
                    //다 연결 안되있다면
                    else{
                        imageView.setImageResource(R.drawable.nwifi);
                    }
                // 문자를 받으면면 텍스트뷰에 시하기
                }else if(cmd.equals("android.provider.Telephony.SMS_RECEIVED")){
                    Toast.makeText(context, "SMS_RECEIVED", Toast.LENGTH_SHORT).show();
                    Bundle bundle = intent.getExtras();
                    Object [] obj = (Object [])bundle.get("pdus");
                    SmsMessage [] messages = new SmsMessage[obj.length];
                    for(int i=0; i<obj.length; i++){
                        String format = bundle.getString("format");
                        messages[i] = SmsMessage.createFromPdu(
                                (byte[]) obj[i], format);
                    }
                    String msg = "";
                    if(messages != null && messages.length > 0){
                        msg += messages[0].getOriginatingAddress()+"\n";
                        msg += messages[0].getMessageBody().toLowerCase()+"\n";
                        msg += new Date(messages[0].getTimestampMillis()).toString();
                        textView.setText(msg);
                    }
                }

            }
        };

        registerReceiver(broadcastReceiver, intentFilter); //가동시킨다 (오면 받는다)

    } // end onCreate


    //반드시 앱이 끝날 때 브로드캐스트리시버 연결을 끊어줘야한다!!
    @Override
    protected void onDestroy() {
        super.onDestroy();
        unregisterReceiver(broadcastReceiver);
    }


    public void ckbt(View v){
        if(v.getId() == R.id.button){
            //퍼미션 콜폰을 확인한다
            int check = PermissionChecker.checkSelfPermission(this,
                    Manifest.permission.CALL_PHONE);
            if(check == PackageManager.PERMISSION_GRANTED){
                Intent intent = new Intent(Intent.ACTION_CALL, Uri.parse("tel:010-9090-9898"));
                startActivity(intent);
            }else{
                Toast.makeText(this, "DENIED", Toast.LENGTH_SHORT).show();
            }
        }else if(v.getId() == R.id.button2){
            //문자를 보낸다  여기도 체크해줘야된다(지금 생략 됨!)
            SmsManager smsManager =
                    SmsManager.getDefault();
            smsManager.sendTextMessage(
                    "tel:010-2323-0432",
                    null,
                    "hi, Man ...",
                    null,
                    null
            );
            Toast.makeText(this, "Send ..OK", Toast.LENGTH_SHORT).show();

        }

    }

}
```

## 리스트뷰 사용하기

<img src="md-images/image-20201015125630105.png" alt="image-20201015125630105" style="zoom:50%;" />

```java
package com.example.p426;

import androidx.appcompat.app.AppCompatActivity;

import android.app.AlertDialog;
import android.content.DialogInterface;
import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;

import java.util.ArrayList;

public class MainActivity extends AppCompatActivity {
    ListView listView;
    ArrayList<String> datas;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listView = findViewById(R.id.listView);
    }

    public void setList(final ArrayList<String> datas){
        //아답터를 넣어 줌으로서 데이터를 뿌린다
        final ArrayAdapter<String> adapter =
                new ArrayAdapter<String>(
                        this,
                        android.R.layout.simple_list_item_1,
                        datas
                );
        listView.setAdapter(adapter);
        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent,
                                    View view, final int position, long id) {

                AlertDialog.Builder builder = new AlertDialog.Builder(MainActivity.this);
                builder.setTitle("Hi");
                //여기 datas를 사용하려면 final이 되어야 한다
                builder.setMessage(datas.get(position) + " Delete?");

                //OK
                builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        // 해당 데이터를 제거
                        datas.remove(position);
                        // 제거 후 다시 화면을 refresh 한다!!!!
                        adapter.notifyDataSetChanged();
                    }
                });
                //NO를 누르면 그대로
                builder.setNegativeButton("NO", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                    }
                });

                AlertDialog dialog = builder.create();
                dialog.show();

            }
        });
    }

    // 임의의 리스트 데이터를 만든다
    public void getData(){
        datas = new ArrayList<>();
        for(int i=0; i<=20; i++){
            datas.add("Item:"+i);
        }
        setList(datas);
    }

    public void ckbt(View v){
        getData();
    }
}
```



- 예제2

​										<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016090518668.png" alt="image-20201016090518668" style="zoom:50%;" /> 

```JAVA
package com.example.p428;


import androidx.appcompat.app.AppCompatActivity;
import androidx.constraintlayout.widget.ConstraintLayout;

import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.BaseAdapter;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.TextView;

import java.util.ArrayList;

public class MainActivity extends AppCompatActivity {

    ListView listView;
    ArrayList<Person> persons;
    LinearLayout container;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listView = findViewById(R.id.listView);

        //리스트 클릭 이벤트 처리
        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent,
                                    View view, final int position, long id) {

                AlertDialog.Builder builder = new AlertDialog.Builder(MainActivity.this);

                LayoutInflater layoutInflater = getLayoutInflater();
                View dview = layoutInflater.inflate(R.layout.dialog,
                        (ViewGroup) findViewById(R.id.dlayout));
                ImageView dimg = dview.findViewById(R.id.imageView2);
                dimg.setImageResource(persons.get(position).getImg());
                builder.setView(dview);


                builder.setTitle("NAME:" + persons.get(position).getName());
                //여기 datas를 사용하려면 final이 되어야 한다
                builder.setMessage(persons.get(position).id + "");

                //OK
                builder.setPositiveButton("YES", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                    }
                });
                //NO를 누르면 그대로
                builder.setNegativeButton("NO", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {

                    }
                });

                builder.show();

            }
        });

    }// end onCreate



    // 나만의 어댑터를 만든다
    class PersonAdapter extends BaseAdapter {

        ArrayList<Person> datas;

        public PersonAdapter(ArrayList<Person> datas) {
            this.datas = datas;
        }

        @Override
        public int getCount() {
            return datas.size();
        }

        @Override
        public Object getItem(int position) {
            return datas.get(position);
        }

        @Override
        public long getItemId(int position) {
            return position;
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            View view = null;
            LayoutInflater inflater =
                    (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);
            view = inflater.inflate(
                    R.layout.person,
                    container,
                    true

            );
            ImageView im = view.findViewById(R.id.imageView);
            TextView tx_id = view.findViewById(R.id.tx_id);
            TextView tx_name = view.findViewById(R.id.tx_name);
            TextView tx_age = view.findViewById(R.id.tx_age);
            Person p = datas.get(position);
            im.setImageResource(p.getImg());
            tx_id.setText(p.getId());
            tx_name.setText(p.getName());
            tx_age.setText("" + p.getAge());

            return view;
        }
    }

    public void setList(final ArrayList<Person> persons) {
        final PersonAdapter personAdapter = new PersonAdapter(persons);
        listView.setAdapter(personAdapter);
    }


    public void getData() {
        persons = new ArrayList<>();
        persons.add(new Person(R.drawable.p1, "id01", "Lee MAlsook", 10));
        persons.add(new Person(R.drawable.p2, "id02", "Kim MAlsook", 20));
        persons.add(new Person(R.drawable.p3, "id03", "Lim MAlsook", 30));
        persons.add(new Person(R.drawable.p4, "id04", "OH MAlsook", 40));
        persons.add(new Person(R.drawable.p5, "id05", "HONG MAlsook", 50));
        persons.add(new Person(R.drawable.p6, "id06", "Ko MAlsook", 60));
        persons.add(new Person(R.drawable.p7, "id07", "Jung MAlsook", 70));
        persons.add(new Person(R.drawable.p8, "id08", "Jin MAlsook", 80));
        persons.add(new Person(R.drawable.p9, "id09", "Cha MAlsook", 90));
        setList(persons);
    }


    public void ckbt(View v) {
        getData();
    }

}
```





## WebView

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016095127987.png" alt="image-20201016095127987" style="zoom:50%;" />

- MainActivity.java

```java
package com.example.p458;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.View;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;

public class MainActivity extends AppCompatActivity {
    WebView webView;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        webView =  findViewById(R.id.webView);
        //안드로이드에서 제공하는 기본적인 브라우저 기능
        webView.setWebViewClient(new WebViewClient());
        //안드로이드 안에서 브라우저 기능을 불러온다
        WebSettings webSettings = webView.getSettings();
        //자바스크립트 허용
        webSettings.setJavaScriptEnabled(true);
        //인터넷 허용 퍼미션 추가
        String permissions[] = {

        };
    }

    public void ckbt(View v){
        if(v.getId() == R.id.button){
            //인터넷 퍼미션을 추가해야 함!
            webView.loadUrl("http://m.naver.com");
        }else if(v.getId() == R.id.button2){
            webView.loadUrl("http://m.daum.net");
        } //java webproject를 불러온다
        else if(v.getId() == R.id.button3){
            webView.loadUrl("http://192.168.0.28/android");
        }
    }

}
```



- AndroidManafest.xml

  ```java
      <uses-permission android:name="android.permission.INTERNET"/>
      <application
          android:usesCleartextTraffic="true"
              .
              .
              .
  ```

  

## SeekBar 및 화면밝기 조절하기

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016095518068.png" alt="image-20201016095518068" style="zoom:50%;" />

```java
package com.example.p464;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.view.WindowManager;
import android.widget.SeekBar;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity {

    SeekBar seekBar;
    TextView textView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        seekBar = findViewById(R.id.seekBar);
        textView = findViewById(R.id.textView);

        seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {
            //seekbar의 이벤트 함수
            @Override
            public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
                //progress는 int라 text로 바꿔줘야 한다
                textView.setText(progress+"");
                //seekbar의 progress에 따라 화면의 밝기를 조절한다
                setBtight(progress);
            }

            @Override
            public void onStartTrackingTouch(SeekBar seekBar) {

            }

            @Override
            public void onStopTrackingTouch(SeekBar seekBar) {

            }
        });

    } // end event

    // 화면의 밝기를 바꾸는 함수
    public void setBtight(int value){
        WindowManager.LayoutParams params = getWindow().getAttributes();
        params.screenBrightness = (float) value / 100;
        getWindow().setAttributes(params);
    }
    
}
```

## Thread

1. Thread & Runnable
   --------------------------   ↑ 자바에서 멀티스레드 구현
2. Handler : 스레드와 연동에서 사용되는 기법
3. AsynchTask : 스레드를 제어할 수 있다
   --------------------------   ↑ 안드로이드에서 멀티스레드 구현

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016125857455.png" alt="image-20201016125857455" style="zoom:50%;" />

```java
package com.example.p474;

import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;

import android.app.AlertDialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.view.View;
import android.widget.Button;
import android.widget.ProgressBar;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity {
    ProgressBar progressBar, progressBar2;
    TextView textView, textView2;
    Button button, button2, button3;
    MyHandler myHandler;
    MyHandler2 myHandler2;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        progressBar = findViewById(R.id.progressBar);
        progressBar2 = findViewById(R.id.progressBar2);
        progressBar.setMax(50);
        progressBar2.setMax(50);
        textView = findViewById(R.id.textView);
        textView2 = findViewById(R.id.textView2);
        button = findViewById(R.id.button);
        button2 = findViewById(R.id.button2);
        button3 = findViewById(R.id.button3);
        myHandler = new MyHandler();
        myHandler2 = new MyHandler2();

    }

    public void ckbt(View v)  {
        if(v.getId() == R.id.button){
            MyThread t = new MyThread(); //extends Theard을 사용할 때 스레스 선언 방법 주의!!!
            t.start();  // 시간이 걸리는 동작 되는 와중에도 아래 내용을 바로 실행
            button.setEnabled(false); // progress가 진행되는 동안 버튼을 누르지 못하게 한다
        }else if(v.getId() == R.id.button2){
            Thread t = new Thread(new MyThread2()); //implements Runnable을 사용할 때 스레스 선언 방법 주의!!!
            t.start();
            button2.setEnabled(false);
        }else if(v.getId() == R.id.button3){
            progress();
        }
    }

    public void progress(){
        final ProgressDialog progressDialog = new ProgressDialog(this);

        AlertDialog.Builder dailog = new AlertDialog.Builder(this);
        dailog.setTitle("progress");
        dailog.setMessage("5 seconds");
        final Handler handler = new Handler();
        dailog.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialog, int which) {
                progressDialog.setCancelable(false);
                progressDialog.setTitle("Downloading...");
                progressDialog.show();
                //스레드를 이용하여 5초 후에 progressDialog를 없엔다
                handler.postDelayed(new Runnable() {
                    @Override
                    public void run() {
                        progressDialog.dismiss();
                    }
                }, 5000);
            }
        });
        dailog.show();
    }




    // Thread t = new Thread(){}; 이렇게도 만들 수 있다
    class MyThread extends Thread{  // inner class 로 만든다
        @Override
        public void run() {
            for(int i=1; i<=50; i++){
                //스레드 안에서 조종
                progressBar.setProgress(i);
                textView.setText(i+"");
                try {
                    Thread.sleep(200);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            //runOnUiThread는 서브스레드에서 메인스레드의 특정 위젯을 변경 하고자 할 때!!
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    button.setEnabled(true); // 프로그레스 진행 후에 버튼을 활성화 시킨다

                }
            });
        }
    };

    //핸들러는 메인스레드에서 작동한다
    //핸들러는 서브스레드 안에서 동작되어지는 변경되어지는 상태를 메인스레드에게 알려준다
    class MyHandler extends Handler{
        @Override
        public void handleMessage(@NonNull Message msg) {
            Bundle bundle = msg.getData();
            int data = bundle.getInt("tdata",0);
            textView.setText("Handler1:"+data);
            progressBar.setProgress(data);
        }
    }

    class MyHandler2 extends Handler{
        @Override
        public void handleMessage(@NonNull Message msg) {
            Bundle bundle = msg.getData();
            int data = bundle.getInt("tdata",0);
            textView2.setText("Handler2:"+data);
            progressBar2.setProgress(data);
            //프로그레스가 50으로 max가 되면 버튼을 다시 활성화 시킨다
            if(data == 50){
                button2.setEnabled(true);
            }
        }
    }

    //Runnable이라는 인터페이스에서 상속받는다
    class MyThread2 implements Runnable{

        @Override
        public void run() {
            for(int i=1; i<=50; i++){
                try {
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                //스레드에서 발생하는 데이터를 여러군대로 보낸다
                Message message = myHandler.obtainMessage();
                Message message2 = myHandler2.obtainMessage();
                Bundle bundle = new Bundle();
                bundle.putInt("tdata",i);
                message.setData(bundle);
                message2.setData(bundle);
                //myHandler.sendMessage(message);
                myHandler2.sendMessage(message2);

            }
        }
    }
}
```



- AsyncTask의 활용

  <img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016145258601.png" alt="image-20201016145258601" style="zoom:50%;" />

  ```java
  package com.example.p489;
  
  import androidx.appcompat.app.AppCompatActivity;
  
  import android.os.AsyncTask;
  import android.os.Bundle;
  import android.view.View;
  import android.widget.Button;
  import android.widget.ImageView;
  import android.widget.SeekBar;
  import android.widget.TextView;
  
  public class MainActivity extends AppCompatActivity {
  
      Button button, button2;
      SeekBar seekBar;
      TextView textView;
      ImageView imageView;
      MyAsynch myAsynch;
  
      @Override
      protected void onCreate(Bundle savedInstanceState) {
          super.onCreate(savedInstanceState);
          setContentView(R.layout.activity_main);
          button = findViewById(R.id.button);
          button2 = findViewById(R.id.button2);
          seekBar = findViewById(R.id.seekBar);
          seekBar.setMax(100);
          textView = findViewById(R.id.textView);
          imageView = findViewById(R.id.imageView);
          button2.setEnabled(false); // 시작,멈춤 버튼 중 시작만 활성화
      }
  
      public void ckbt1(View v){
          myAsynch = new MyAsynch();
          myAsynch.execute(100); //이 함수로 asynch를 실행한다
      }
  
      public void ckbt2(View v){
          myAsynch.cancel(true);
          myAsynch.onCancelled();
      }
  
      //                               <  시작  , 중간  ,  결과 >
      class MyAsynch extends AsyncTask<Integer,Integer,String>{
  
          //스레드 시작전 실행 되는 함수로 실행시 시작 비활성화, 멈춤 활성화
          @Override
          protected void onPreExecute() {
              button.setEnabled(false);
              button2.setEnabled(true);
          }
  
          //스레드의 run과 같다, 스레드 시작
          @Override
          protected String doInBackground(Integer... integers) {
              int a = integers[0].intValue();
              int sum = 0;
              for(int i=0;i<=a;i++){
                  if(isCancelled() == true){
                      break;
                  }
                  sum += i;
                  publishProgress(i);  //Integer i 값을 onProgressUpdate한테 던진다
                  try {
                      Thread.sleep(100);
                  } catch (InterruptedException e) {
                      e.printStackTrace();
                  }
              }
              return "result: " +sum;
          }
  
          //스레드 도중
          @Override
          protected void onProgressUpdate(Integer... values) {
              int i = values[0].intValue();
              seekBar.setProgress(i);
              if(i<=30){
                  imageView.setImageResource(R.drawable.down);
              }else if(i <= 70){
                  imageView.setImageResource(R.drawable.middle);
              }else if(i <= 100){
                  imageView.setImageResource(R.drawable.up);
              }
          }
  
          //스레드가 끝나면
          //스레스 시작전 실행 되는 함수로 실행시 시작 활성화, 멈춤 비활성화
          @Override
          protected void onPostExecute(String s) {
              textView.setText(s);
              button.setEnabled(true);
              button2.setEnabled(false);
          }
  
          // 취소시 시작 활성화, 멈춤 비활성화
          @Override
          protected void onCancelled() {
              seekBar.setProgress(0);
              textView.setText("");
              imageView.setImageResource(R.drawable.ic_launcher_background);
              button.setEnabled(true);
              button2.setEnabled(false);
          }
      }
  
  }
  ```

  

## 네트워크

앱에서 자바로 쿼리스트링을 날려서 id/pwd가 맞는지 확인한 후

맞으면 "1"을 아니면 "2"를 보낸다

id01/pwd01이 입력되어있으면 Activity2로 이동하고

아니면 대화상자를 표시한다

<img src="%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C/image-20201016160030523.png" alt="image-20201016160030523" style="zoom:50%;" />

- MainActiviti.java

```java
package com.example.p500;

import androidx.appcompat.app.AppCompatActivity;

import android.app.AlertDialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {

    TextView tx_id, tx_pwd;
    HttpAsync httpAsync;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tx_id = findViewById(R.id.tx_id);
        tx_pwd = findViewById(R.id.tx_pwd);
    }

    public void ck(View v){
        String id = tx_id.getText().toString();
        String pwd = tx_pwd.getText().toString();
        String url = "http://192.168.0.28/android/login.jsp";
        url += "?id="+id+"&pwd="+pwd;
        //String result = HttpConnect.getString(url); <- 서브스레드 안에서 해야한다!!
        httpAsync = new HttpAsync();
        httpAsync.execute(url);
    }

    class HttpAsync extends AsyncTask<String,String,String>{

        ProgressDialog progressDialog;

        @Override
        protected void onPreExecute() {
            progressDialog = new ProgressDialog(MainActivity.this);
            progressDialog.setTitle("Login ...");
            progressDialog.setCancelable(false);
            progressDialog.show();
        }

        @Override
        protected String doInBackground(String... strings) {
           //Manifest 수정 필요!
            String url = strings[0];
            String result = HttpConnect.getString(url);
            return result;
        }

        @Override
        protected void onProgressUpdate(String... values) {

        }

        @Override
        protected void onPostExecute(String s) {
            Toast.makeText(MainActivity.this, s, Toast.LENGTH_SHORT).show();
            progressDialog.dismiss();
            String s1 = s.trim();
            Log.d("[TEST]",s1+"    "+s.getClass().getName());

            if(s1.equals("1")){
                Intent intent = new Intent(getApplicationContext(),SecondActivity.class);
                //intent.putExtra("data", 100); //데이터를 담아서 다음 액티비티로 전달
                //intent.putExtra("str", "String Data");

                startActivity(intent);
            }else{
                AlertDialog.Builder builder = new AlertDialog.Builder(MainActivity.this);
                builder.setTitle("My Dialog");
                builder.setMessage("Login fail");

                //OK을 누르면 종료
                builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        return;
                    }
                });

                AlertDialog dialog = builder.create();
                dialog.show();
            }
        }

    }

}
```



- SecondActivity.java

```
package com.example.p500;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;

public class SecondActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_second);
    }
}
```





- HttpConnect.java

```
package com.example.p500;

import java.io.BufferedInputStream;
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class HttpConnect {
        public static String getString(String urlstr){
            String result = null;
            URL url = null;
            HttpURLConnection hcon = null;
            InputStream is = null;
            try{
                url = new URL(urlstr);
                hcon = (HttpURLConnection)url.openConnection();
                hcon.setConnectTimeout(2000);
                hcon.setRequestMethod("GET");
                is = new BufferedInputStream(hcon.getInputStream());
                result = convertStr(is);
            }catch(Exception e){
                e.printStackTrace();
            }

            return result;
        }

        public static String convertStr(InputStream is){
            String result = null;
            BufferedReader bi = null;
            StringBuilder sb = new StringBuilder();
            try{
                bi = new BufferedReader(
                        new InputStreamReader(is)
                );
                String temp = "";
                while((temp =bi.readLine()) != null){
                    sb.append(temp);
                }
            }catch(Exception e){
                e.printStackTrace();
            }
            return sb.toString();
        }
}
```



- 이클립스에서 192.168.0.28/android/login.jsp

  ```java
  <%@ page language="java" contentType="text/html; charset=EUC-KR"
      pageEncoding="UTF-8"%>
  <%
  
  	String id = request.getParameter("id");
  	String pwd = request.getParameter("pwd");
  	System.out.println(id+" "+pwd);
  	Thread.sleep(3000);
  	if(id.equals("id01") && pwd.equals("pwd01")){
  		out.print("1");
  	}else{
  		out.print("2");
  	}
  
  %>
  ```

  